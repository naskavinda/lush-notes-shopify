<header class="header full-width">
  <div class="header__container">
    <!-- Logo/Brand -->
    <div class="header__logo">
      <a href="{{ routes.root_url }}" class="header__logo-link">
        {% if section.settings.logo != blank %}
          {{ section.settings.logo | image_url: width: section.settings.logo_width | image_tag: class: 'header__logo-image', alt: shop.name }}
        {% else %}
          <span class="header__logo-text">{{ shop.name }}</span>
        {% endif %}
      </a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="header__mobile-toggle" type="button" aria-label="Toggle menu">
      <span class="header__mobile-toggle-line"></span>
      <span class="header__mobile-toggle-line"></span>
      <span class="header__mobile-toggle-line"></span>
    </button>

    <!-- Main Navigation -->
    <nav class="header__nav">
      <ul class="header__menu">
        {% if section.settings.show_default_navigation %}
          <!-- Home -->
          <li class="header__menu-item">
            <a href="{{ routes.root_url }}" class="header__menu-link {% if request.page_type == 'index' %}header__menu-link--active{% endif %}">
              {{ 'general.navigation.home' | t }}
            </a>
          </li>

        <!-- Shop with dropdown -->
        <li class="header__menu-item">
          <a href="{{ collections.all.url }}" class="header__menu-link {% if request.page_type == 'collection' or request.page_type == 'product' %}header__menu-link--active{% endif %}">
            {{ 'general.navigation.shop' | t }}
            <svg class="header__dropdown-icon" width="12" height="8" viewBox="0 0 12 8" fill="none">
              <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
          <ul class="header__submenu">
            {% for collection in collections limit: 6 %}
              {% unless collection.handle == 'frontpage' %}
                <li class="header__submenu-item">
                  <a href="{{ collection.url }}" class="header__submenu-link">{{ collection.title }}</a>
                </li>
              {% endunless %}
            {% endfor %}
            <li class="header__submenu-item">
              <a href="{{ collections.all.url }}" class="header__submenu-link">{{ 'general.navigation.view_all' | t }}</a>
            </li>
          </ul>
        </li>

        <!-- Best Sellers -->
        <li class="header__menu-item">
          <a href="{{ collections[section.settings.best_sellers_collection].url | default: '/collections/best-seller' }}" class="header__menu-link">
            {{ 'general.navigation.best_sellers' | t }}
          </a>
        </li>

        <!-- Weekly Offers -->
        <li class="header__menu-item">
          <a href="{{ collections[section.settings.weekly_offers_collection].url | default: '/collections/weekly-offer' }}" class="header__menu-link">
            {{ 'general.navigation.weekly_offers' | t }}
          </a>
        </li>

        <!-- About Us -->
        <li class="header__menu-item">
          <a href="{{ pages['about-us'].url | default: '/pages/about-us' }}" class="header__menu-link">
            {{ 'general.navigation.about_us' | t }}
          </a>
        </li>

        <!-- Contact -->
        <li class="header__menu-item">
          <a href="{{ pages.contact.url | default: '/pages/contact' }}" class="header__menu-link">
            {{ 'general.navigation.contact' | t }}
          </a>
        </li>

          <!-- Pre Order -->
          <li class="header__menu-item">
            <a href="{{ collections[section.settings.pre_order_collection].url | default: collections.all.url }}" class="header__menu-link">
              {{ 'general.navigation.pre_order' | t }}
            </a>
          </li>
        {% endif %}

        <!-- Custom menu fallback -->
        {% if section.settings.menu.links.size > 0 %}
          {% for link in section.settings.menu.links %}
            <li class="header__menu-item">
              <a href="{{ link.url }}" class="header__menu-link {% if link.active %}header__menu-link--active{% endif %}">
                {{ link.title }}
                {% if link.links != blank %}
                  <svg class="header__dropdown-icon" width="12" height="8" viewBox="0 0 12 8" fill="none">
                    <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                {% endif %}
              </a>
              {% if link.links != blank %}
                <ul class="header__submenu">
                  {% for child_link in link.links %}
                    <li class="header__submenu-item">
                      <a href="{{ child_link.url }}" class="header__submenu-link">{{ child_link.title }}</a>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}
        {% endif %}
      </ul>
    </nav>

    <!-- Right Side Actions -->
    <div class="header__actions">
      <!-- Search Icon -->
      <button class="header__action-btn header__search-btn" type="button" aria-label="{{ 'general.search.title' | t }}">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
          <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>

      <!-- Account/Sign In -->
      {% if shop.customer_accounts_enabled %}
        <div class="header__account-wrapper">
          {% if customer %}
            <button class="header__action-btn header__account-btn" type="button" data-account-toggle>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span class="header__action-text">
                {%- if customer.first_name != blank -%}
                  {{ customer.first_name }}
                {%- else -%}
                  {{ 'customer.account.title' | t }}
                {%- endif -%}
              </span>
              <svg class="header__account-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none">
                <polyline points="6,9 12,15 18,9" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
            
            <div class="header__account-dropdown" data-account-dropdown>
              <div class="header__account-dropdown-content">
                <div class="header__account-info">
                  <div class="header__account-name">{{ customer.first_name }} {{ customer.last_name }}</div>
                  <div class="header__account-email">{{ customer.email }}</div>
                </div>
                
                <nav class="header__account-nav">
                  <a href="{{ routes.account_url }}" class="header__account-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ 'customer.account.title' | t }}
                  </a>
                  
                  <a href="{{ routes.account_url }}#orders" class="header__account-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M9 11H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-4" stroke="currentColor" stroke-width="2"/>
                      <path d="M9 7l3-3 3 3" stroke="currentColor" stroke-width="2"/>
                      <path d="M12 4v14" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ 'customer.account.orders' | t }}
                  </a>
                  
                  <a href="{{ routes.account_addresses_url }}" class="header__account-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2"/>
                      <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ 'customer.account.addresses' | t }}
                  </a>
                  
                  <div class="header__account-divider"></div>
                  
                  <a href="{{ routes.account_logout_url }}" class="header__account-link header__account-link--logout">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" stroke="currentColor" stroke-width="2"/>
                      <polyline points="16,17 21,12 16,7" stroke="currentColor" stroke-width="2"/>
                      <line x1="21" y1="12" x2="9" y2="12" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ 'customer.account.logout' | t }}
                  </a>
                </nav>
              </div>
            </div>
          {% else %}
            <a href="{{ routes.account_login_url }}" class="header__action-btn header__signin-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" stroke="currentColor" stroke-width="2"/>
                <polyline points="10,17 15,12 10,7" stroke="currentColor" stroke-width="2"/>
                <line x1="15" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span class="header__action-text">{{ 'customer.login_page.title' | t }}</span>
            </a>
          {% endif %}
        </div>
      {% endif %}

      <!-- Wishlist -->
      <a href="/pages/wishlist" class="header__action-btn header__wishlist-btn" aria-label="{{ 'general.wishlist.title' | t }}">
        <div class="header__wishlist-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2"/>
          </svg>
          <span class="header__wishlist-count" style="display: none;">0</span>
        </div>
      </a>

      <!-- Cart -->
      <button class="header__action-btn header__cart-btn" data-cart-drawer-open aria-label="{{ 'cart.title' | t }}">
        <div class="header__cart-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2"/>
            <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2"/>
            <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2"/>
          </svg>
          {% if cart.item_count > 0 %}
            <span class="header__cart-count">{{ cart.item_count }}</span>
          {% endif %}
        </div>
      </button>
    </div>
  </div>
</header>

{% stylesheet %}
  /* Prevent scrolling when mobile menu is open */
  body.menu-open {
    overflow: hidden;
  }

  .header {
    background-color: #1a1a1a;
    border-bottom: 1px solid #333;
    position: sticky;
    top: 0;
    z-index: 1000;
    width: 100%;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    overflow-x: hidden; /* Prevent horizontal scrollbar */
  }

  .header__container {
    width: 100%;
    max-width: 100vw; /* Prevent container from exceeding viewport width */
    padding: 0 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 70px;
    overflow-x: hidden; /* Prevent horizontal scrollbar */
  }

  /* Logo */
  .header__logo {
    flex-shrink: 0; /* Prevent logo from shrinking */
    min-width: fit-content; /* Ensure logo maintains its required space */
  }

  .header__logo-link {
    text-decoration: none;
    color: #fff;
    font-size: 1.75rem;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    letter-spacing: -0.025em;
    white-space: nowrap; /* Prevent text wrapping */
  }

  .header__logo-image {
    max-height: 40px;
    width: auto;
  }

  .header__logo-text {
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  /* Navigation */
  .header__nav {
    flex: 1;
    display: flex;
    justify-content: center;
    overflow: visible; /* Ensure submenus can overflow the nav container */
  }

  .header__menu {
    display: flex;
    align-items: center;
    gap: 2.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
    overflow: visible; /* Ensure submenus can overflow the menu container */
  }

  .header__menu-item {
    position: relative;
    z-index: auto; /* Ensure proper stacking context for submenus */
  }

  .header__menu-link {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.75rem 0;
    color: #fff;
    text-decoration: none;
    font-weight: 400;
    font-size: 1rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    letter-spacing: 0.025em;
    transition: color 0.2s ease;
  }

  .header__menu-link:hover,
  .header__menu-link--active {
    color: #ff6b35;
  }

  .header__dropdown-icon {
    transition: transform 0.2s ease;
  }

  .header__menu-item:hover .header__dropdown-icon {
    transform: rotate(180deg);
  }

  /* Submenu */
  .header__submenu {
    position: absolute;
    top: 100%;
    left: 0;
    background-color: #2a2a2a;
    border-radius: 8px;
    padding: 0.5rem 0;
    min-width: 200px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    list-style: none;
    margin: 0;
    z-index: 9999; /* Ensure submenu appears above all other elements */
  }

  .header__menu-item:hover .header__submenu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .header__submenu-item {
    margin: 0;
  }

  .header__submenu-link {
    display: block;
    padding: 0.5rem 1rem;
    color: #fff;
    text-decoration: none;
    font-size: 0.875rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight: 400;
    letter-spacing: 0.025em;
    transition: background-color 0.2s ease;
  }

  .header__submenu-link:hover {
    background-color: #333;
  }

  /* Actions */
  .header__actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-shrink: 0; /* Prevent actions from shrinking and causing overflow */
  }

  .header__action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: none;
    border: none;
    color: #fff;
    text-decoration: none;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .header__action-btn:hover {
    color: #ff6b35;
  }

  .header__action-text {
    font-size: 0.875rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight: 400;
    white-space: nowrap;
  }

  /* Sign In Button */
  .header__sign-in-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background-color: #ff6b35;
    color: #fff;
    text-decoration: none;
    border-radius: 6px;
    font-weight: 500;
    font-size: 0.875rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    letter-spacing: 0.025em;
    transition: background-color 0.2s ease;
  }

  .header__sign-in-btn:hover {
    background-color: #e55a2e;
    color: #fff;
  }

  /* Cart */
  .header__cart-icon {
    position: relative;
  }

  .header__cart-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #ff6b35;
    color: #fff;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.15rem 0.4rem;
    border-radius: 50%;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  /* Wishlist */
  .header__wishlist-icon {
    position: relative;
  }

  .header__wishlist-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background-color: #ff6b35;
    color: #fff;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.15rem 0.4rem;
    border-radius: 50%;
    min-width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  /* Mobile Menu Toggle */
  .header__mobile-toggle {
    display: none;
    flex-direction: column;
    justify-content: space-between;
    width: 24px;
    height: 18px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  .header__mobile-toggle-line {
    display: block;
    width: 100%;
    height: 2px;
    background-color: #fff;
    transition: all 0.3s ease;
  }

  .header__mobile-toggle.active .header__mobile-toggle-line:first-child {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .header__mobile-toggle.active .header__mobile-toggle-line:nth-child(2) {
    opacity: 0;
  }

  .header__mobile-toggle.active .header__mobile-toggle-line:last-child {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .header__container {
      padding: 0 1rem;
      height: 60px;
      width: 100%;
      max-width: 100vw; /* Prevent container from exceeding viewport width */
      overflow-x: hidden; /* Prevent horizontal scrollbar */
    }

    .header__mobile-toggle {
      display: flex;
      order: 2;
    }

    .header__logo {
      order: 1;
    }

    .header__nav {
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      background-color: #1a1a1a;
      border-top: 1px solid #333;
      padding: 1rem;
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      order: 4;
    }

    .header__nav.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .header__menu {
      flex-direction: column;
      gap: 0;
      width: 100%;
    }

    .header__menu-item {
      width: 100%;
      border-bottom: 1px solid #333;
    }

    .header__menu-item:last-child {
      border-bottom: none;
    }

    .header__menu-link {
      padding: 1rem 0;
      width: 100%;
      justify-content: space-between;
    }

    .header__submenu {
      position: static;
      background-color: #2a2a2a;
      opacity: 1;
      visibility: visible;
      transform: none;
      box-shadow: none;
      border-radius: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .header__menu-item:hover .header__submenu,
    .header__menu-item.active .header__submenu {
      max-height: 300px;
    }

    .header__actions {
      gap: 0.5rem;
      order: 3;
      flex-shrink: 0; /* Prevent actions from shrinking */
      min-width: fit-content; /* Ensure actions maintain their minimum required width */
    }

    .header__action-text {
      display: none;
    }

    .header__sign-in-btn {
      padding: 0.5rem;
    }

    .header__sign-in-btn span {
      display: none;
    }
  }

  /* Account Dropdown Styles */
  .header__account-wrapper {
    position: relative;
    z-index: 1001; /* Ensure account dropdown appears above submenus */
  }

  .header__account-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .header__account-arrow {
    transition: transform 0.2s ease;
  }

  .header__account-btn[aria-expanded="true"] .header__account-arrow {
    transform: rotate(180deg);
  }

  .header__account-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    border: 1px solid #e5e7eb;
    min-width: 280px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    z-index: 10000; /* Ensure account dropdown appears above all other elements */
  }

  .header__account-dropdown--open {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .header__account-dropdown-content {
    padding: 20px;
  }

  .header__account-info {
    padding-bottom: 16px;
    margin-bottom: 16px;
    border-bottom: 1px solid #e5e7eb;
  }

  .header__account-name {
    font-weight: 600;
    color: var(--color-foreground);
    margin-bottom: 4px;
  }

  .header__account-email {
    font-size: 0.875rem;
    color: var(--color-foreground-secondary);
  }

  .header__account-nav {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .header__account-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    border-radius: 8px;
    color: var(--color-foreground);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: background-color 0.2s ease;
  }

  .header__account-link:hover {
    background-color: #f8fafc;
  }

  .header__account-link--logout {
    color: #dc2626;
  }

  .header__account-link--logout:hover {
    background-color: #fef2f2;
  }

  .header__account-divider {
    height: 1px;
    background-color: #e5e7eb;
    margin: 8px 0;
  }

  /* Sign In Button */
  .header__signin-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background-color: #e97547;
    color: white;
    text-decoration: none;
    font-weight: 600;
    padding: 10px 16px;
    border-radius: 8px;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    border: none;
  }

  .header__signin-btn:hover {
    background-color: #d4633f;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(233, 117, 71, 0.3);
  }

  .header__signin-btn svg {
    width: 16px;
    height: 16px;
  }

  @media (max-width: 480px) {
    .header__actions {
      gap: 0.25rem;
    }

    .header__action-btn {
      padding: 0.25rem;
    }

    .header__signin-btn {
      padding: 8px 12px;
      font-size: 0.75rem;
    }

    .header__signin-btn .header__action-text {
      display: none;
    }

    .header__signin-btn svg {
      width: 18px;
      height: 18px;
    }

    .header__account-dropdown {
      right: -10px;
      min-width: 260px;
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const mobileToggle = document.querySelector('.header__mobile-toggle');
    const nav = document.querySelector('.header__nav');
    const menuItems = document.querySelectorAll('.header__menu-item');

    if (mobileToggle && nav) {
      mobileToggle.addEventListener('click', function() {
        mobileToggle.classList.toggle('active');
        nav.classList.toggle('active');
        document.body.classList.toggle('menu-open');
      });

      // Close menu when clicking outside
      document.addEventListener('click', function(e) {
        if (!mobileToggle.contains(e.target) && !nav.contains(e.target)) {
          mobileToggle.classList.remove('active');
          nav.classList.remove('active');
          document.body.classList.remove('menu-open');
        }
      });

      // Handle submenu toggles on mobile
      menuItems.forEach(function(item) {
        const link = item.querySelector('.header__menu-link');
        const submenu = item.querySelector('.header__submenu');
        
        if (link && submenu) {
          link.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
              e.preventDefault();
              item.classList.toggle('active');
            }
          });
        }
      });

      // Handle window resize
      window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
          mobileToggle.classList.remove('active');
          nav.classList.remove('active');
          document.body.classList.remove('menu-open');
          menuItems.forEach(function(item) {
            item.classList.remove('active');
          });
        }
      });
    }

    // Account dropdown functionality
    const accountToggle = document.querySelector('[data-account-toggle]');
    const accountDropdown = document.querySelector('[data-account-dropdown]');

    if (accountToggle && accountDropdown) {
      accountToggle.addEventListener('click', function() {
        const isOpen = accountDropdown.classList.contains('header__account-dropdown--open');
        
        if (isOpen) {
          accountDropdown.classList.remove('header__account-dropdown--open');
          accountToggle.setAttribute('aria-expanded', 'false');
        } else {
          accountDropdown.classList.add('header__account-dropdown--open');
          accountToggle.setAttribute('aria-expanded', 'true');
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!accountToggle.contains(e.target) && !accountDropdown.contains(e.target)) {
          accountDropdown.classList.remove('header__account-dropdown--open');
          accountToggle.setAttribute('aria-expanded', 'false');
        }
      });

      // Close dropdown on escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          accountDropdown.classList.remove('header__account-dropdown--open');
          accountToggle.setAttribute('aria-expanded', 'false');
        }
      });
    }

    // Wishlist count functionality
    function updateWishlistCount() {
      try {
        const wishlist = JSON.parse(localStorage.getItem('product-wishlist')) || [];
        const countElement = document.querySelector('.header__wishlist-count');
        
        console.log('🔢 Updating wishlist count:', wishlist.length, 'items');
        console.log('📍 Count element found:', !!countElement);
        
        if (countElement) {
          const count = wishlist.length;
          countElement.textContent = count;
          countElement.style.display = count > 0 ? 'flex' : 'none';
          console.log('✅ Wishlist count updated to:', count);
        } else {
          console.warn('❌ Wishlist count element not found');
        }
      } catch (e) {
        console.error('🚨 Error updating wishlist count:', e);
      }
    }
    
    // Make function globally available for debugging
    window.updateWishlistCount = updateWishlistCount;

    // Initialize wishlist count
    updateWishlistCount();

    // Listen for localStorage changes (for cross-tab updates)
    window.addEventListener('storage', function(e) {
      if (e.key === 'product-wishlist') {
        updateWishlistCount();
      }
    });

    // Custom event listener for wishlist updates within the same tab
    window.addEventListener('wishlistUpdated', updateWishlistCount);
  });
{% endjavascript %}

{% schema %}
{
  "name": "t:general.header",
  "settings": [
    {
      "type": "header",
      "content": "t:general.logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "t:labels.logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "t:labels.logo_width",
      "default": 150
    },
    {
      "type": "header",
      "content": "t:general.navigation"
    },
    {
      "type": "checkbox",
      "id": "show_default_navigation",
      "label": "Show default navigation items",
      "info": "Shows Home, Shop, Best Sellers, Weekly Offers, About Us, Contact, Pre Order",
      "default": true
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "t:labels.menu",
      "info": "Additional custom menu items (will be added after default items)"
    },
    {
      "type": "text",
      "id": "best_sellers_collection",
      "label": "Best Sellers collection handle",
      "default": "best-seller",
      "info": "Handle of the collection for Best Sellers link"
    },
    {
      "type": "text",
      "id": "weekly_offers_collection",
      "label": "Weekly Offers collection handle",
      "default": "weekly-offer",
      "info": "Handle of the collection for Weekly Offers link"
    },
    {
      "type": "text",
      "id": "pre_order_collection",
      "label": "Pre Order collection handle",
      "default": "pre-order",
      "info": "Handle of the collection for Pre Order link"
    }
  ]
}
{% endschema %}
