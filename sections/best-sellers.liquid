<!-- Best Sellers Section -->
<section class="best-sellers">
  <div class="best-sellers__container">
    <div class="best-sellers__header">
      {% if section.settings.title != blank %}
        <h2 class="best-sellers__title">{{ section.settings.title }}</h2>
      {% endif %}
      
      {% if section.settings.subtitle != blank %}
        <p class="best-sellers__subtitle">{{ section.settings.subtitle }}</p>
      {% endif %}
    </div>

    <div class="best-sellers__content">
      <!-- Navigation Arrows -->
      <button class="best-sellers__nav best-sellers__nav--prev" type="button" aria-label="Previous products">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- Products Grid -->
      <div class="best-sellers__products" id="best-sellers-grid">
        {% if section.settings.collection != blank %}
          {% assign collection = collections[section.settings.collection] %}
        {% else %}
          {% assign collection = collections.all %}
        {% endif %}
        
        {% if collection and collection.products.size > 0 %}
          {% for product in collection.products limit: section.settings.products_to_show %}
            <div class="best-sellers__product-card">
              <div class="product-card">
                <div class="product-card__image">
                  {% if product.featured_image %}
                    <a href="{{ product.url }}">
                      {{ product.featured_image | image_url: width: 400 | image_tag: alt: product.title, loading: 'lazy' }}
                    </a>
                  {% else %}
                    <div class="product-card__placeholder">
                      {{ 'image' | placeholder_svg_tag: 'product-card__placeholder-svg' }}
                    </div>
                  {% endif %}
                  
                  {% if product.compare_at_price > product.price %}
                    {% assign discount_percentage = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price | round %}
                    <span class="product-card__badge product-card__badge--sale">
                      {{ discount_percentage }}% OFF
                    </span>
                  {% endif %}
                  
                  <!-- Wishlist button -->
                  <button class="product-card__wishlist" type="button" aria-label="Add to wishlist">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </button>
                </div>

                <div class="product-card__content">
                  <h3 class="product-card__title">
                    <a href="{{ product.url }}">{{ product.title }}</a>
                  </h3>
                  
                  <!-- Product description excerpt -->
                  {% if product.description != blank %}
                    <p class="product-card__description">{{ product.description | strip_html | truncate: 100 }}</p>
                  {% endif %}
                  
                  <div class="product-card__price">
                    {% if product.compare_at_price > product.price %}
                      <span class="product-card__price--sale">{{ product.price | money }}</span>
                      <span class="product-card__price--original">{{ product.compare_at_price | money }}</span>
                    {% else %}
                      <span class="product-card__price--regular">{{ product.price | money }}</span>
                    {% endif %}
                  </div>

                  {% form 'product', product, class: 'product-card__form' %}
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                    <button type="submit" class="product-card__add-to-cart" {% unless product.available %}disabled{% endunless %}>
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                        <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      {% if product.available %}
                        {{ 'products.product.add_to_cart' | t }}
                      {% else %}
                        {{ 'products.product.sold_out' | t }}
                      {% endif %}
                    </button>
                  {% endform %}
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="best-sellers__empty">
            <p>{{ 'sections.best_sellers.empty' | t }}</p>
            {% unless section.settings.collection != blank %}
              <p style="color: #999; font-size: 0.9rem; margin-top: 0.5rem;">Please select a collection in the theme settings to display products.</p>
            {% endunless %}
          </div>
        {% endif %}
      </div>

      <!-- Navigation Arrows -->
      <button class="best-sellers__nav best-sellers__nav--next" type="button" aria-label="Next products">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    {% if section.settings.show_view_all %}
      <div class="best-sellers__footer">
        {% liquid
          assign view_all_url = section.settings.view_all_url
          if view_all_url == blank
            if section.settings.collection != blank
              assign view_all_url = collections[section.settings.collection].url
            else
              assign view_all_url = '/collections/best-seller'
            endif
          endif
        %}
        <a href="{{ view_all_url }}" class="best-sellers__view-all">
          {{ 'sections.best_sellers.view_all' | t }}
        </a>
      </div>
    {% endif %}
  </div>
</section>

{% stylesheet %}
  .best-sellers {
    padding: 4rem 0;
    background-color: #fbf9fa;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
  }

  .best-sellers__container {
    width: 100%;
    padding: 0 2rem;
    max-width: none;
  }

  .best-sellers__header {
    text-align: center;
    margin-bottom: 3rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
  }

  .best-sellers__title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 1rem;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    letter-spacing: -0.025em;
  }

  .best-sellers__subtitle {
    font-size: 1.125rem;
    color: #666;
    max-width: 650px;
    margin: 0 auto;
    line-height: 1.6;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight: 400;
    letter-spacing: 0.025em;
  }

  .best-sellers__content {
    position: relative;
    display: flex;
    align-items: center;
    gap: 2rem;
  }

  .best-sellers__nav {
    flex-shrink: 0;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 2px solid #e0e0e0;
    background-color: #fff;
    color: #666;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .best-sellers__nav:hover {
    border-color: #ff6b35;
    color: #ff6b35;
    transform: scale(1.05);
  }

  .best-sellers__nav:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .best-sellers__products {
    flex: 1;
    display: flex;
    gap: 1.5rem;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-behavior: smooth;
    padding-bottom: 1rem;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .best-sellers__products::-webkit-scrollbar {
    display: none;
  }

  .best-sellers__product-card {
    flex: 0 0 280px;
    min-width: 280px;
  }

  .product-card {
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .product-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
  }

  .product-card__image {
    position: relative;
    aspect-ratio: 1;
    overflow: hidden;
  }

  .product-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-card__image img {
    transform: scale(1.05);
  }

  .product-card__placeholder {
    width: 100%;
    height: 100%;
    background-color: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-card__placeholder-svg {
    width: 64px;
    height: 64px;
    opacity: 0.3;
  }

  .product-card__badge {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    padding: 0.375rem 0.75rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.025em;
    z-index: 2;
  }

  .product-card__badge--sale {
    background-color: #e53e3e;
    color: #fff;
  }

  .product-card__wishlist {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.9);
    border: none;
    color: #666;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2;
    backdrop-filter: blur(10px);
  }

  .product-card__wishlist:hover {
    background-color: #fff;
    color: #e53e3e;
    transform: scale(1.1);
  }

  .product-card__content {
    padding: 1.25rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .product-card__title {
    margin-bottom: 0.5rem;
  }

  .product-card__title a {
    color: #1a1a1a;
    text-decoration: none;
    font-size: 1rem;
    font-weight: 600;
    line-height: 1.4;
    transition: color 0.3s ease;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    letter-spacing: 0.025em;
  }

  .product-card__title a:hover {
    color: #ff6b35;
  }

  .product-card__description {
    font-size: 0.875rem;
    color: #666;
    line-height: 1.5;
    margin-bottom: 0.75rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-weight: 400;
  }

  .product-card__price {
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .product-card__price--regular {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1a1a1a;
  }

  .product-card__price--sale {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1a1a1a;
  }

  .product-card__price--original {
    font-size: 0.875rem;
    color: #999;
    text-decoration: line-through;
    margin-left: 0.5rem;
  }

  .product-card__form {
    margin: 0;
    margin-top: auto;
  }

  .product-card__add-to-cart {
    width: 100%;
    padding: 0.875rem 1rem;
    border: none;
    background-color: #1a1a1a;
    color: #fff;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-transform: none;
  }

  .product-card__add-to-cart:hover:not(:disabled) {
    background-color: #ff6b35;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
  }

  .product-card__add-to-cart:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }

  .best-sellers__footer {
    text-align: center;
    margin-top: 3rem;
  }

  .best-sellers__view-all {
    display: inline-flex;
    align-items: center;
    padding: 1rem 2rem;
    background-color: #333;
    color: #fff;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .best-sellers__view-all:hover {
    background-color: #ff6b35;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
  }

  .best-sellers__empty {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    color: #666;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .best-sellers {
      padding: 3rem 0;
    }

    .best-sellers__container {
      padding: 0 1rem;
    }

    .best-sellers__title {
      font-size: 2rem;
    }

    .best-sellers__content {
      flex-direction: column;
      gap: 1rem;
    }

    .best-sellers__nav {
      display: flex;
    }

    .best-sellers__products {
      gap: 1rem;
    }

    .best-sellers__product-card {
      flex: 0 0 250px;
      min-width: 250px;
    }
  }

  @media (max-width: 480px) {
    .best-sellers__product-card {
      flex: 0 0 220px;
      min-width: 220px;
    }

    .best-sellers__products {
      gap: 0.75rem;
    }

    .product-card__content {
      padding: 1rem;
    }

    .best-sellers__title {
      font-size: 1.75rem;
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const prevBtn = document.querySelector('.best-sellers__nav--prev');
    const nextBtn = document.querySelector('.best-sellers__nav--next');
    const productsGrid = document.querySelector('.best-sellers__products');

    if (prevBtn && nextBtn && productsGrid) {
      let scrollAmount = 300;

      prevBtn.addEventListener('click', function() {
        productsGrid.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
      });

      nextBtn.addEventListener('click', function() {
        productsGrid.scrollBy({ left: scrollAmount, behavior: 'smooth' });
      });

      // Update button states based on scroll position
      function updateButtonStates() {
        const isAtStart = productsGrid.scrollLeft <= 0;
        const isAtEnd = productsGrid.scrollLeft >= productsGrid.scrollWidth - productsGrid.clientWidth;
        
        prevBtn.disabled = isAtStart;
        nextBtn.disabled = isAtEnd;
      }

      productsGrid.addEventListener('scroll', updateButtonStates);
      updateButtonStates(); // Initial state
    }
  });
{% endjavascript %}

{% schema %}
{
  "name": "t:sections.best_sellers.name",
  "tag": "section",
  "class": "section-best-sellers",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.best_sellers.settings.title.label",
      "default": "Best Sellers"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "t:sections.best_sellers.settings.subtitle.label",
      "default": "Discover our most beloved fragrances, chosen by our community"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "t:sections.best_sellers.settings.collection.label"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "t:sections.best_sellers.settings.products_to_show.label",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "t:sections.best_sellers.settings.show_view_all.label",
      "default": true
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "View all button URL",
      "info": "Optional custom URL for the View All button. If empty, it will use the selected collection URL."
    }
  ],
  "presets": [
    {
      "name": "t:sections.best_sellers.presets.best_sellers.name"
    }
  ]
}
{% endschema %}